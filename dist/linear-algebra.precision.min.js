!function(r,t){"use strict";"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():r.linearAlgebra=t()}(this,function(){"use strict";var r=function(r){throw new Error("linear-algebra: "+r)},t=function(t,o,s){r("["+t+"] op1 is "+o.rows+" x "+o.cols+" and op2 is "+s.rows+" x "+s.cols)};return function(o){o=o||{};var s={},n=s.Matrix=function(r){Array.isArray(r[0])?(this.data=r,this.rows=r.length,this.cols=r[0].length):(this.data=[r],this.rows=1,this.cols=r.length)};n.prototype.clone=function(){return new n(this.toArray())},n.prototype.toArray=function(){for(var r=this.data,t=this.rows,o=this.cols,s=new Array(t),n=0;t>n;++n)s[n]=r[n].slice(0,o);return s},n.prototype.ravel=function(){for(var r=this.data,t=this.rows,o=this.cols,s=new Array(t*o),n=0,a=0;t>n;++n,a+=o)for(var i=0;o>i;++i)s[a+i]=r[n][i];return s},n.identity=function(r){return n.scalar(r,1)},n.scalar=function(r,t){var o,s,a=new Array(r);for(o=0;r>o;++o){for(a[o]=new Array(r),s=0;r>s;++s)a[o][s]=0;a[o][o]=t}return new n(a)},n.zeros=function(r,t){for(var o=new Array(r),s=0;r>s;++s){o[s]=[];for(var a=0;t>a;++a)o[s][a]=0}return new n(o)},n.reshape=function(t,o,s){var a=[];if(t.length!==o*s&&r("value length is "+t.length+" and rows x cols is "+o*s),o*s===t.length)for(var i=0;i<t.length;i+=s)a.push(t.slice(i,s+i));return new n(a)};var a=(s.Vector={zero:function(r){for(var t=new Array(r),o=0;r>o;++o)t[o]=0;return new n(t)}},o.add);a||r("options.add must be set for precision calculation"),n.prototype.trans=function(){var r,t,o=this.data,s=this.rows,a=this.cols,i=new Array(a);for(t=0;a>t;++t)for(i[t]=new Array(s),r=0;s>r;++r)i[t][r]=o[r][t];return new n(i)},n.prototype.trans_=function(){var r,t,o,s=this.data,n=this.rows,a=this.cols,i=a===n,e=a>n?n:a;for(r=0;e>r;++r)for(t=r+1;e>t;++t)o=s[t][r],s[t][r]=s[r][t],s[r][t]=o;if(!i){if(a>n)for(t=n;a>t;++t)for(Array.isArray(s[t])||(s[t]=new Array(n)),r=0;n>r;++r)s[t][r]=s[r][t];else for(r=a;n>r;++r)for(t=0;a>t;++t)s[t][r]=s[r][t];o=n,this.rows=a,this.cols=o}return this},n.prototype.div=function(r){var o=this.data,s=this.rows,a=this.cols,i=r.data,e=r.rows,h=r.cols;(s!==e||a!==h)&&t("div",this,r);var f,u,c=new Array(s);for(f=0;s>f;++f)for(c[f]=new Array(a),u=0;a>u;++u)c[f][u]=o[f][u]/i[f][u];return new n(c)},n.prototype.div_=function(r){var o=this.data,s=this.rows,n=this.cols,a=r.data,i=r.rows,e=r.cols;(s!==i||n!==e)&&t("div_",this,r);var h,f;for(h=0;s>h;++h)for(f=0;n>f;++f)o[h][f]=o[h][f]/a[h][f];return this},n.prototype.mul=function(r){var o=this.data,s=this.rows,a=this.cols,i=r.data,e=r.rows,h=r.cols;(s!==e||a!==h)&&t("mul",this,r);var f,u,c=new Array(s);for(f=0;s>f;++f)for(c[f]=new Array(a),u=0;a>u;++u)c[f][u]=o[f][u]*i[f][u];return new n(c)},n.prototype.mul_=function(r){var o=this.data,s=this.rows,n=this.cols,a=r.data,i=r.rows,e=r.cols;(s!==i||n!==e)&&t("mul_",this,r);var h,f;for(h=0;s>h;++h)for(f=0;n>f;++f)o[h][f]=o[h][f]*a[h][f];return this},n.prototype.plus=function(r){var o=this.data,s=this.rows,a=this.cols,i=r.data,e=r.rows,h=r.cols;(s!==e||a!==h)&&t("plus",this,r);var f,u,c=new Array(s);for(f=0;s>f;++f)for(c[f]=new Array(a),u=0;a>u;++u)c[f][u]=o[f][u]+i[f][u];return new n(c)},n.prototype.plus_=function(r){var o=this.data,s=this.rows,n=this.cols,a=r.data,i=r.rows,e=r.cols;(s!==i||n!==e)&&t("plus_",this,r);var h,f;for(h=0;s>h;++h)for(f=0;n>f;++f)o[h][f]=o[h][f]+a[h][f];return this},n.prototype.minus=function(r){var o=this.data,s=this.rows,a=this.cols,i=r.data,e=r.rows,h=r.cols;(s!==e||a!==h)&&t("minus",this,r);var f,u,c=new Array(s);for(f=0;s>f;++f)for(c[f]=new Array(a),u=0;a>u;++u)c[f][u]=o[f][u]-i[f][u];return new n(c)},n.prototype.minus_=function(r){var o=this.data,s=this.rows,n=this.cols,a=r.data,i=r.rows,e=r.cols;(s!==i||n!==e)&&t("minus_",this,r);var h,f;for(h=0;s>h;++h)for(f=0;n>f;++f)o[h][f]=o[h][f]-a[h][f];return this},n.prototype.dot=function(r){var o=this.data,s=this.rows,i=this.cols,e=r.data,h=r.rows,f=r.cols;i!==h&&t("dot",this,r);var u,c,w,l,p=new Array(s);for(u=0;s>u;++u)for(p[u]=new Array(f),w=0;f>w;++w){for(l=new Array(h),c=0;h>c;++c)l[c]=o[u][c]*e[c][w];p[u][w]=a(l)}return new n(p)},n.prototype.dot_=function(r){var o=this.data,s=this.rows,n=this.cols,i=r.data,e=r.rows,h=r.cols;n!==e&&t("dot_",this,r);var f,u,c,w,l;for(f=0;s>f;++f)for(w=o[f].slice(0,n),c=0;h>c;++c){for(l=new Array(e),u=0;u<r.rows;++u)l[u]=w[u]*i[u][c];o[f][c]=a(l)}return this.cols=h,this},n.prototype.getSum=function(t){var o=this.data,s=this.rows,n=this.cols,i=function(r){for(var t=r.data,o=r.rows,s=r.cols,n=new Array(o),i=0;o>i;++i){for(var e=new Array(s),h=0;s>h;++h)e[h]=t[i][h];n[i]=a(e)}return n};if(0===t)return i(this.trans());if(1===t)return i(this);if(null===t||void 0===t){for(var e=new Array(s*n),h=0,f=0;s>h;++h,f+=n)for(var u=0;n>u;++u)e[f+u]=o[h][u];return a(e)}r("[getSum] axis is "+t)},n.prototype.getNorm=function(){for(var r=this.data,t=this.rows,o=this.cols,s=new Array(t*o),n=0,i=0;t>n;++n,i+=o)for(var e=0;o>e;++e)s[i+e]=Math.pow(Math.abs(r[n][e]),2);return Math.sqrt(a(s))},n.prototype.getMean=function(){return this.getSum()/(this.rows*this.cols)},n.prototype.map=function(r){var t,o,s=this.data,a=this.rows,i=this.cols,e=new Array(a);for(t=0;a>t;++t)for(e[t]=new Array(i),o=0;i>o;++o)e[t][o]=r(s[t][o]);return new n(e)},n.prototype.map_=function(r){var t,o,s=this.data,n=this.rows,a=this.cols;for(t=0;n>t;++t)for(o=0;a>o;++o)s[t][o]=r(s[t][o]);return this},n.prototype.log=function(){var r,t,o=this.data,s=this.rows,a=this.cols,i=new Array(s);for(r=0;s>r;++r)for(i[r]=new Array(a),t=0;a>t;++t)i[r][t]=Math.log(o[r][t]);return new n(i)},n.prototype.log_=function(){var r,t,o=this.data,s=this.rows,n=this.cols;for(r=0;s>r;++r)for(t=0;n>t;++t)o[r][t]=Math.log(o[r][t]);return this},n.prototype.sigmoid=function(){var r,t,o=this.data,s=this.rows,a=this.cols,i=new Array(s);for(r=0;s>r;++r)for(i[r]=new Array(a),t=0;a>t;++t)i[r][t]=1/(1+Math.exp(-o[r][t]));return new n(i)},n.prototype.sigmoid_=function(){var r,t,o=this.data,s=this.rows,n=this.cols;for(r=0;s>r;++r)for(t=0;n>t;++t)o[r][t]=1/(1+Math.exp(-o[r][t]));return this};var i=function(r){return isNaN(r)?0:r===Number.POSITIVE_INFINITY?Number.MAX_VALUE:r===Number.NEGATIVE_INFINITY?-Number.MAX_VALUE:r};return n.prototype.nanToNum=function(){var r,t,o=this.data,s=this.rows,a=this.cols,e=new Array(s);for(r=0;s>r;++r)for(e[r]=new Array(a),t=0;a>t;++t)e[r][t]=i(o[r][t]);return new n(e)},n.prototype.nanToNum_=function(){var r,t,o=this.data,s=this.rows,n=this.cols;for(r=0;s>r;++r)for(t=0;n>t;++t)o[r][t]=i(o[r][t]);return this},n.prototype.mulEach=function(r){var t,o,s=this.data,a=this.rows,i=this.cols,e=new Array(a);for(t=0;a>t;++t)for(e[t]=new Array(i),o=0;i>o;++o)e[t][o]=s[t][o]*r;return new n(e)},n.prototype.mulEach_=function(r){var t,o,s=this.data,n=this.rows,a=this.cols;for(t=0;n>t;++t)for(o=0;a>o;++o)s[t][o]=s[t][o]*r;return this},n.prototype.plusEach=function(r){var t,o,s=this.data,a=this.rows,i=this.cols,e=new Array(a);for(t=0;a>t;++t)for(e[t]=new Array(i),o=0;i>o;++o)e[t][o]=s[t][o]+r;return new n(e)},n.prototype.plusEach_=function(r){var t,o,s=this.data,n=this.rows,a=this.cols;for(t=0;n>t;++t)for(o=0;a>o;++o)s[t][o]=s[t][o]+r;return this},n.prototype.eleMap=function(r){var t,o,s=this.data,a=this.rows,i=this.cols,e=new Array(a);for(t=0;a>t;++t)for(e[t]=new Array(i),o=0;i>o;++o)e[t][o]=r(s[t][o],t,o);return new n(e)},n.prototype.eleMap_=function(r){var t,o,s=this.data,n=this.rows,a=this.cols;for(t=0;n>t;++t)for(o=0;a>o;++o)s[t][o]=r(s[t][o],t,o);return this},n.prototype.getMax=function(t){var o=this.data,s=this.rows,n=this.cols,a=function(r){for(var t=r.data,o=r.rows,s=r.cols,n=new Array(o),a=0;o>a;++a){for(var i=t[a][0],e=0,h=0;s>h;++h)t[a][h]>i&&(i=t[a][h],e=h);n[a]=i}return n};if(0===t)return a(this.trans());if(1===t)return a(this);if(null===t||void 0===t){for(var i=o[0][0],e=0,h=0;s>h;++h)for(var f=0;n>f;++f)o[h][f]>i&&(i=o[h][f],e=n*h+f);return i}r("[getMax] axis is "+t)},n.prototype.getMin=function(t){var o=this.data,s=this.rows,n=this.cols,a=function(r){for(var t=r.data,o=r.rows,s=r.cols,n=new Array(o),a=0;o>a;++a){for(var i=t[a][0],e=0,h=0;s>h;++h)t[a][h]<i&&(i=t[a][h],e=h);n[a]=i}return n};if(0===t)return a(this.trans());if(1===t)return a(this);if(null===t||void 0===t){for(var i=o[0][0],e=0,h=0;s>h;++h)for(var f=0;n>f;++f)o[h][f]<i&&(i=o[h][f],e=n*h+f);return i}r("[getMin] axis is "+t)},n.prototype.getArgMax=function(t){var o=this.data,s=this.rows,n=this.cols,a=function(r){for(var t=r.data,o=r.rows,s=r.cols,n=new Array(o),a=0;o>a;++a){for(var i=t[a][0],e=0,h=0;s>h;++h)t[a][h]>i&&(i=t[a][h],e=h);n[a]=e}return n};if(0===t)return a(this.trans());if(1===t)return a(this);if(null===t||void 0===t){for(var i=o[0][0],e=0,h=0;s>h;++h)for(var f=0;n>f;++f)o[h][f]>i&&(i=o[h][f],e=n*h+f);return e}r("[getArgMax] axis is "+t)},n.prototype.getArgMin=function(t){var o=this.data,s=this.rows,n=this.cols,a=function(r){for(var t=r.data,o=r.rows,s=r.cols,n=new Array(o),a=0;o>a;++a){for(var i=t[a][0],e=0,h=0;s>h;++h)t[a][h]<i&&(i=t[a][h],e=h);n[a]=e}return n};if(0===t)return a(this.trans());if(1===t)return a(this);if(null===t||void 0===t){for(var i=o[0][0],e=0,h=0;s>h;++h)for(var f=0;n>f;++f)o[h][f]<i&&(i=o[h][f],e=n*h+f);return e}r("[getArgMin] axis is "+t)},n.prototype.softmax=function(r){var t,o;return t=function(r){var t,o,s;return t=r.getMax(),o=r.eleMap(function(r){return Math.exp(r-t)}),s=o.getSum(),o.eleMap(function(r){return r/s})},o=function(r){var o,s,a=r.data,i=r.rows,e=new Array(i);for(o=0;i>o;++o)s=new n(a[o]),e[o]=t(s).toArray()[0];return new n(e)},0===r?o(this.trans()).trans():1===r?o(this):null===r||void 0===r?t(this):void 0},n.prototype.softmax_=function(r){var t,o;return t=function(r){var t,o;return t=r.getMax(),r.eleMap_(function(r){return Math.exp(r-t)}),o=r.getSum(),r.eleMap_(function(r){return r/o})},o=function(r){var o,s,a=r.data,i=r.rows;for(o=0;i>o;++o)s=new n(a[o]),a[o]=t(s).toArray()[0];return r},0===r?o(this.trans()).trans():1===r?o(this):null===r||void 0===r?t(this):void 0},n.prototype.relu=function(){var r,t,o=this.data,s=this.rows,a=this.cols,i=new Array(s);for(r=0;s>r;++r)for(i[r]=new Array(a),t=0;a>t;++t)i[r][t]=Math.max(0,o[r][t]);return new n(i)},n.prototype.relu_=function(){var r,t,o=this.data,s=this.rows,n=this.cols;for(r=0;s>r;++r)for(t=0;n>t;++t)o[r][t]=Math.max(0,o[r][t]);return this},s}});